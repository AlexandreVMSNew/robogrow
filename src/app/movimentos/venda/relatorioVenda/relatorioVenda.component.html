<h2>Relatório Vendas</h2>
<hr width="100%">
<div class="box box-primary">
  <div class="box-header with-border">
    <div class="row">


      <div class="form-group col-md-3" style="position:inherit;">
        <label>Período de Datas:</label>
        <app-date-input *ngIf="this.dataPeriodo" [datas]="this.dataPeriodo" (ngModel)="setDataFiltro($event)">
        </app-date-input>

      </div>


      <div style="margin-right: 15px; margin-top: 24px;">
        <a [routerLink]="" (click)="getVendas(this.dataPeriodo)" class="btn btn-primary">
          <i class="fa fa-search"></i>&nbsp; Gerar Relatório
        </a>
      </div>
    </div>
    <tabset *ngIf="this.relatorioVendas">
      <tab heading="Geral" style="margin-top: 10px;">
        <div class="row">
          <div class="col-md-5">
            <div class="box box-primary">
              <div class="box-header with-border">
                <h3 class="box-title">Vendas por Status</h3>
              </div>
              <div class="box-body">
                <app-grafico-pie-chart *ngIf="this.pieChartData && this.pieChartLabels"
                  [pieChartData]="this.pieChartData" [pieChartLabels]="this.pieChartLabels"
                  [pieChartColors]="pieChartColors">
                </app-grafico-pie-chart>
              </div>
            </div>
          </div>
          <div class="col-md-5">
            <div class="info-box">
              <span class="info-box-icon"><i class="fa fa-handshake"></i></span>

              <div class="info-box-content">
                <span class="info-box-text">Total de Vendas Negociadas</span>
                <span class="info-box-number" style="font-size:35px;">{{this.relatorioVendas.qtdTotal}}</span>
              </div>
            </div>
          </div>
        </div>


      </tab>
      <tab heading="Detalhado" style="margin-top: 10px;">
        <table style="margin-top: 15px;border-collapse:inherit;" class="table table-striped table-bordered mt-4">
          <thead class="thead-light">
            <tr>
              <th>Número</th>
              <th>Cliente(Nome Fantasia)</th>
              <th style="white-space: nowrap;">Data Negociação</th>
              <th style="text-align: center;">Status</th>
              <th style="text-align: center;">Receitas</th>
              <th style="text-align: center;">Despesas(Gastos)</th>
              <th style="text-align: center;">Despesas(Comissões)</th>
              <th style="text-align: center;">Resultado</th>
              <th style="text-align: center;">Ações</th>
            </tr>
          </thead>
          <tbody *ngIf="this.relatorioVendas.vendasDetalhadas && this.relatorioVendas.vendasDetalhadas.length">
            <tr
              *ngFor="let vendaDetalhada of this.relatorioVendas.vendasDetalhadas">
              <td>{{ vendaDetalhada.numeroAno }}</td>
              <td style="white-space: nowrap;">
                <ng-template #myPopover>
                  <label>Razão Social: {{vendaDetalhada.clientes.razaoSocial}}</label>
                </ng-template>

                <a role="button" [routerLink]="" [popover]="myPopover" popoverTitle="Informações do Cliente"
                  popoverPlacement="top"
                  (click)="abrirTemplateClienteModal(vendaDetalhada.clientesId)"
                  triggers="mouseenter:mouseleave">
                  {{ vendaDetalhada.clientes.nomeFantasia }}
                </a>
              </td>
              <td style="white-space: nowrap;">{{ vendaDetalhada.dataNegociacao  | date:'dd/MM/yyyy'}}</td>
              <td style="text-align: center;">

                <span *ngIf="vendaDetalhada.status == 'EM NEGOCIAÇÃO'" class="badge badge-secondary">
                  {{ vendaDetalhada.status }}
                </span>
                <span *ngIf="vendaDetalhada.status == 'A IMPLANTAR'" class="badge badge-warning">
                  {{ vendaDetalhada.status }}
                </span>
                <span *ngIf="vendaDetalhada.status == 'EM IMPLANTAÇÃO'" class="badge badge-info">
                  {{ vendaDetalhada.status }}
                </span>
                <span *ngIf="vendaDetalhada.status == 'IMPLANTADO'" class="badge badge-primary">
                  {{ vendaDetalhada.status }}
                </span>
                <span *ngIf="vendaDetalhada.status == 'FINALIZADO'" class="badge badge-success">
                  {{ vendaDetalhada.status }}
                </span>
                <span *ngIf="vendaDetalhada.status == 'DISTRATADO'" class="badge badge-danger">
                  {{ vendaDetalhada.status }}
                </span>
              </td>
              <td [ngClass]="(vendaDetalhada.valorBrutoReceitas > 0) ? 'celulaVerde' : 'celulaAzul'"
                style=" text-align: center;font-size:20px;">
                {{vendaDetalhada.valorBrutoReceitas | currency:' ':true}}
              </td>
              <td [ngClass]="(vendaDetalhada.valorBrutoDespesasGastos > 0) ? 'celulaVermelha' : 'celulaAzul'"
                style="text-align: center;font-size:20px;">
                {{vendaDetalhada.valorBrutoDespesasGastos | currency:' ':true}}
              </td>
              <td [ngClass]="(vendaDetalhada.valorBrutoDespesasComissao > 0) ? 'celulaVermelha' : 'celulaAzul'"
                style="text-align: center;font-size:20px;">
                {{vendaDetalhada.valorBrutoDespesasComissao | currency:' ':false}}
              </td>
              <td
                [ngClass]="(vendaDetalhada.valorLiquidoResultado > 0) ? 'celulaVerde' : ((vendaDetalhada.valorLiquidoResultado == 0) ? 'celulaAzul' : 'celulaVermelha')"
                style="text-align: center;font-size:20px;">
                {{vendaDetalhada.valorLiquidoResultado | currency:' ':false}}
              </td>
              <td style="text-align: center;white-space: nowrap;">
                <div class="btn-group">
                  <a [routerLink]="" (click)="abrirTemplateVendaModal(vendaDetalhada.id)"
                    tooltip="Ir para Venda" class="btn btn-sm btn-primary">
                    <i class="fa fa-edit"></i>
                  </a>
                </div>
              </td>
            </tr>
            <tr>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td style="text-align: center;font-size:20px;">
                <span class="badge badge-success">
                  Total Receitas
                </span>
              </td>
              <td></td>
              <td style="text-align: center;font-size:20px;">
                <span class="badge badge-danger">
                  Total Despesas
                </span>
              </td>
              <td style="text-align: center;font-size:20px;">
                <span class="badge badge-info">
                  Total Liquído
                </span>
              </td>
              <td></td>
            </tr>
            <tr>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td style="text-align: center;font-size:20px;">
                {{this.relatorioVendas.valorBrutoReceitas | currency:' ':true}}
              </td>
              <td></td>
              <td style="text-align: center;font-size:20px;">
                {{this.relatorioVendas.valorBrutoDespesas | currency:' ':false}}
              </td>
              <td style="text-align: center;font-size:20px;">
                {{this.relatorioVendas.valorLiquidoResultado | currency:' ':false}}
              </td>
              <td></td>
            </tr>
          </tbody>
          <tfoot *ngIf="!this.relatorioVendas.vendasDetalhadas">
            <tr colspan="7" class="text-center"></tr>
            <h4>
              Nenhuma venda encontrada!
            </h4>
          </tfoot>
        </table>
      </tab>

      <tab heading="Resultado" style="margin-top: 10px;">

        <div class="box">
          <div class="box-header with-border">
            <h3 class="box-title">Grafico Geral</h3>
          </div>
          <div class="box-body">
            <div class="form-inline">
              <div class="col-md-8">
                <p class="text-center">
                  <strong>Vendas Negociadas entre: {{this.dataPeriodo.dataInicialPTBR}} -
                    {{this.dataPeriodo.dataFinalPTBR}}</strong>
                </p>
                <app-grafico-bar-chart *ngIf="this.barChartData && this.barChartLabels"
                  [maxValor]="26000" [minValor]="0" [frequencia]="2000"
                  [barChartData]="this.barChartData" [barChartLabels]="this.barChartLabels">
                </app-grafico-bar-chart>
              </div>
              <div class="col-md-4">
                <div class="row">
                  <div class="col-sm-10 col-xs-12">
                    <div class="info-box">
                      <span class="info-box-icon"><i class="fa fa-dollar"></i></span>

                      <div class="info-box-content">
                        <span class="info-box-text">Valor Bruto de Receitas</span>
                        <span class="info-box-number"
                          style="font-size:35px;">{{this.relatorioVendas.valorBrutoReceitas | currency:'BRL':true}}</span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-sm-10 col-xs-12">
                    <div class="info-box">
                      <span class="info-box-icon"><i class="fa fa-dollar"></i></span>

                      <div class="info-box-content">
                        <span class="info-box-text">Valor Bruto de Despesas</span>
                        <span class="info-box-number"
                          style="font-size:35px;">{{this.relatorioVendas.valorBrutoDespesas | currency:'BRL':true}}</span>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-sm-10 col-xs-12">
                    <div class="info-box">
                      <span class="info-box-icon"><i class="fa fa-dollar"></i></span>

                      <div class="info-box-content">
                        <span class="info-box-text">Valor Líquido de Vendas</span>
                        <span class="info-box-number"
                          style="font-size:35px;">{{this.relatorioVendas.valorLiquidoResultado | currency:'BRL':true}}</span>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-sm-10 col-xs-12">
                    <div class="info-box">
                      <span class="info-box-icon"><i class="fa fa-dollar"></i></span>

                      <div class="info-box-content">
                        <span class="info-box-text">Valor Médio</span>
                        <span class="info-box-number"
                          style="font-size:35px;">{{this.relatorioVendas.valorMedio | currency:'BRL':true}}</span>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-sm-10 col-xs-12">
                    <div class="info-box">
                      <span class="info-box-icon"><i class="fa fa-dollar"></i></span>

                      <div class="info-box-content">
                        <span class="info-box-text">Valor Top</span>
                        <span class="info-box-number"
                          style="font-size:35px;">{{this.relatorioVendas.valorTop | currency:'BRL':true}}</span>
                      </div>
                    </div>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>

      </tab>
    </tabset>
  </div>
</div>

<app-template-modal id="venda" *ngIf="this.getTemplateModalVenda() == true"
  [templateModalService]="this.templateModalVendaService" [component]="this.componentModal" [width]="80"
  [inputs]="this.inputs"></app-template-modal>
<app-template-modal id="cliente" *ngIf="this.getTemplateModalCliente() == true"
  [templateModalService]="this.templateModalClienteService" [component]="this.componentModal" [width]="80"
  [inputs]="this.inputs"></app-template-modal>