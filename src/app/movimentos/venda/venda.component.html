
<h2>Venda</h2>

<hr width="100%">
<div class="box box-solid">
  <div class="box-header with-border">
    <div class="row">
      <div class="form-group col-md-2">
        <label>Filtrar por:</label>
        <ng-select [clearable]="false" [items]="filtrarPor" name="filtrarPor" [(ngModel)]="filtroSelecionado"
          (change)="setFiltroSelecionado($event)">
        </ng-select>
      </div>

      <div class="form-group col-md-3">
        <label>Filtro:</label>
        <input type="text" style="text-transform: uppercase" class="form-control" placeholder="..." name="filtro" [(ngModel)]="filtroTexto" />
      </div>

      <div class="form-group col-md-2">
        <label>Status:</label>
        <ng-select [clearable]="false" [items]="status" name="statusFiltro" [(ngModel)]="statusFiltroSelecionado"
          (change)="setStatusFiltroSelecionado($event)">
        </ng-select>
      </div>

      <div *ngIf="this.novo == true" style="margin-right: 15px;" class="pull-right">
        <a [routerLink]="['novo']" class="btn btn-success">
          <i class="fa fa-plus-circle"></i>&nbsp; Nova Venda
        </a>
        <a (click)="abrirVendaConfig()" style="margin-left:5px;" class="btn btn-primary">
          <i class="fa fa-gear"></i>
        </a>
      </div>
    </div>
    <table style="margin-top: 15px;" class="table table-striped table-bordered mt-4">
      <thead class="thead-light">
        <tr>
          <th>Número</th>
          <th>Cliente(Nome Fantasia)</th>
          <th>Data Emissão</th>
          <th style="text-align: center;">Status</th>
          <th style="text-align: center;">Ações</th>
        </tr>
      </thead>
      <tbody *ngIf="vendas && vendas.length">
        <tr
          *ngFor="let venda of vendasFiltro | paginate: { itemsPerPage: 50,currentPage: paginaAtual, totalItems: totalRegistros };">
          <td>{{ venda.numeroAno }}</td>
          <td style="white-space: nowrap;">
              <ng-template #myPopover >
                <label>Razão Social: {{venda.clientes.razaoSocial}}</label>
              </ng-template>
       
              <a role="button" [popover]="myPopover"
                popoverTitle="Informações do Cliente"
                popoverPlacement="top" 
                (click)="abrirTemplateModal(editarClienteComponent, venda.clientesId)"
                triggers="mouseenter:mouseleave">
                {{ venda.clientes.nomeFantasia }}
              </a> 
            
            <i class="fa fa-info-circle"></i> 
          </td>
          <td style="white-space: nowrap;">{{ venda.dataEmissao  | date:'dd/MM/yyyy HH:mm'}}</td>
          <td style="text-align: center;">

            <span *ngIf="venda.status == 'EM NEGOCIAÇÃO'" style="background-color:grey;" class="label">
              {{ venda.status }}
            </span> 
            <span *ngIf="venda.status == 'EM IMPLANTAÇÃO'" class="label label-warning">
              {{ venda.status }}
            </span>
            <span *ngIf="venda.status == 'IMPLANTADO'" class="label label-info">
              {{ venda.status }}
            </span>
            <span *ngIf="venda.status == 'FINALIZADO'" class="label label-success">
              {{ venda.status }}
            </span>
            <span *ngIf="venda.status == 'DISTRATADO'" class="label label-danger">
              {{ venda.status }}
            </span></td>
          <td style="text-align: center;white-space: nowrap;">
            <div *ngIf="this.visualizar == true" class="btn-group">
              <a [routerLink]="['/movimentos/vendas','editar', venda.id]" tooltip="Editar/Detalhes"
                class="btn btn-sm btn-primary">
                <i class="fa fa-edit"></i>
              </a>
            </div>
          </td>
        </tr>
      </tbody>
      <tfoot *ngIf="!vendas">
        <tr colspan="7" class="text-center"></tr>
        <h4>
          Nenhuma venda encontrada!
        </h4>
      </tfoot>
    </table>
    Total de Registros: {{totalRegistros}}
    <div class="text-center">
      <pagination-controls (pageChange)="paginaAtual = $event" name="retornoPagination" previousLabel="Anterior"
        nextLabel="Próximo">
      </pagination-controls>
    </div>
  </div>

</div>
<app-template-modal *ngIf="this.getTemplateModal() == true" 
                    [component]="this.componentModal"
                    [width]="70"
                    [inputs]="this.inputs"></app-template-modal>
<app-config-venda *ngIf="getVendaConfig() == true"></app-config-venda>